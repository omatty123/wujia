<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ru / Dao / Mo / Fa — Interactive Matrix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+SC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ru:#d4af37; --dao:#4a90e2; --mo:#50c878; --fa:#e74c3c;
      --ink:#222; --soft:#fafafa; --card:#fff; --line:#d9d9d9; --muted:#6b7280;
      --pill:#f5f5f5; --pill-border:#444;
      --good:#c8f2c8; --good-b:#4caf50; --bad:#f7c2c2; --bad-b:#e53935;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--soft); color:var(--ink);
      font-family: "Inter", Arial, sans-serif;
    }
    header{
      text-align:center; padding:18px 12px;
    }
    header h1{
      margin:0; font-size:1.9rem; font-weight:700;
    }
    header p{
      margin:6px 0 0; color:var(--muted); font-size:.95rem;
    }

    /* Layout */
    .wrap{
      max-width:1280px; margin:0 auto; padding:14px;
      display:grid; grid-template-columns: 66% 34%; gap:14px;
    }
    .panel{
      background:var(--card); border:1px solid var(--line); border-radius:8px;
    }

    /* Matrix (table) */
    .matrix{
      overflow:auto; padding:10px;
    }
    table{
      width:100%; border-collapse:collapse;
      font-size:.96rem;
    }
    thead th{
      position:sticky; top:0; z-index:2;
      background:#f4f6f8; border-bottom:1px solid var(--line);
      padding:10px 8px; text-align:center; font-weight:700;
    }
    thead th:first-child{ text-align:left; width:140px; }
    tbody th{
      position:sticky; left:0; z-index:1; background:#f4f6f8;
      text-align:left; padding:10px 8px; border-right:1px solid var(--line);
      width:140px; font-weight:600;
    }
    td{
      padding:8px; border:1px dashed #cfcfcf; vertical-align:top; min-height:120px;
    }
    .school{
      font-weight:700; font-size:1.05rem; margin-bottom:2px;
    }
    .school .cn{
      font-family:"Noto Sans SC", sans-serif; font-weight:700; margin-right:6px;
    }
    .ru  .school{ color:var(--ru); }
    .dao .school{ color:var(--dao); }
    .mo  .school{ color:var(--mo); }
    .fa  .school{ color:var(--fa); }

    .dropzone{
      min-height:120px; background:#fcfcfc; border-radius:6px; padding:6px;
    }
    .dropzone.highlight{ outline:2px dashed #999; outline-offset:2px; }

    /* Bank */
    .bank{
      display:flex; flex-direction:column; max-height:85vh; overflow:auto;
    }
    .bank h2{
      margin:10px 10px 6px; text-align:center; font-size:1rem; font-weight:700;
    }
    .bank-section{
      border-top:1px solid var(--line); padding:10px;
    }
    .bank-section:first-of-type{ border-top:none; }
    .bank-section h3{
      margin:0 0 8px; font-size:.95rem; font-weight:700; color:var(--muted);
    }
    .bank-grid{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:8px;
    }

    /* Token pill */
    .item{
      display:inline-block; padding:5px 8px; background:var(--pill);
      border:1px solid var(--pill-border); border-radius:6px;
      cursor:grab; font-size:.9rem; line-height:1.2; user-select:none;
      transition:background .15s, border-color .15s;
    }
    .item:hover{ background:#eee; }
    .cn{
      font-family:"Noto Sans SC", sans-serif; margin-left:4px; font-weight:600;
    }

    /* Feedback */
    .item.correct{ background:var(--good)!important; border-color:var(--good-b)!important; }
    .item.incorrect{ background:var(--bad)!important; border-color:var(--bad-b)!important; }

    /* Controls */
    .controls{
      display:flex; justify-content:center; gap:10px; padding:10px 0 18px;
    }
    button{
      appearance:none; border:none; border-radius:6px; padding:8px 14px;
      font-weight:700; cursor:pointer; font-size:.92rem; color:#fff;
      transition:filter .15s;
    }
    button.check{ background:#4caf50; }
    button.reset{ background:#1976d2; }
    button:hover{ filter:brightness(.95); }

    /* Compact on small screens */
    @media (max-width: 920px){
      .wrap{ grid-template-columns:1fr; }
      thead th:first-child, tbody th{ width:120px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>四大哲学流派 · Ru Jia · Dao Jia · Mo Jia · Fa Jia</h1>
    <p>Drag tokens from the Answer Bank (right) into the correct school <em>and</em> category.</p>
  </header>

  <div class="wrap">
    <!-- MATRIX -->
    <section class="panel matrix" id="matrix">
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th class="ru"><div class="school"><span class="cn">儒家</span>Ru Jia</div></th>
            <th class="dao"><div class="school"><span class="cn">道家</span>Dao Jia</div></th>
            <th class="mo"><div class="school"><span class="cn">墨家</span>Mo Jia</div></th>
            <th class="fa"><div class="school"><span class="cn">法家</span>Fa Jia</div></th>
          </tr>
        </thead>
        <tbody>
          <!-- Key People -->
          <tr>
            <th>Key People</th>
            <td><div class="dropzone" data-school="ru"  data-category="people"></div></td>
            <td><div class="dropzone" data-school="dao" data-category="people"></div></td>
            <td><div class="dropzone" data-school="mo"  data-category="people"></div></td>
            <td><div class="dropzone" data-school="fa"  data-category="people"></div></td>
          </tr>
          <!-- Key Concepts -->
          <tr>
            <th>Key Concepts</th>
            <td><div class="dropzone" data-school="ru"  data-category="concepts"></div></td>
            <td><div class="dropzone" data-school="dao" data-category="concepts"></div></td>
            <td><div class="dropzone" data-school="mo"  data-category="concepts"></div></td>
            <td><div class="dropzone" data-school="fa"  data-category="concepts"></div></td>
          </tr>
          <!-- Aphorisms -->
          <tr>
            <th>Aphorisms / Thought Experiments</th>
            <td><div class="dropzone" data-school="ru"  data-category="aphorisms"></div></td>
            <td><div class="dropzone" data-school="dao" data-category="aphorisms"></div></td>
            <td><div class="dropzone" data-school="mo"  data-category="aphorisms"></div></td>
            <td><div class="dropzone" data-school="fa"  data-category="aphorisms"></div></td>
          </tr>
          <!-- Contemporary Applications -->
          <tr>
            <th>Contemporary Applications</th>
            <td><div class="dropzone" data-school="ru"  data-category="applications"></div></td>
            <td><div class="dropzone" data-school="dao" data-category="applications"></div></td>
            <td><div class="dropzone" data-school="mo"  data-category="applications"></div></td>
            <td><div class="dropzone" data-school="fa"  data-category="applications"></div></td>
          </tr>
        </tbody>
      </table>

      <div class="controls">
        <button class="check" onclick="checkAnswers()">Check Answers</button>
        <button class="reset" onclick="resetBoard()">Reset Board</button>
      </div>
    </section>

    <!-- BANK -->
    <aside class="panel bank" id="bankPanel">
      <h2>Answer Bank</h2>

      <div class="bank-section" id="bank-people">
        <h3>Key People</h3>
        <div class="bank-grid"></div>
      </div>

      <div class="bank-section" id="bank-concepts">
        <h3>Key Concepts</h3>
        <div class="bank-grid"></div>
      </div>

      <div class="bank-section" id="bank-aphorisms">
        <h3>Aphorisms / Thought Experiments</h3>
        <div class="bank-grid"></div>
      </div>

      <div class="bank-section" id="bank-applications">
        <h3>Contemporary Applications</h3>
        <div class="bank-grid"></div>
      </div>
    </aside>
  </div>

  <script>
    // ---------- TOKENS (ALL PRESERVED) ----------
    const PEOPLE = [
      {id:"kongzi",   text:"Kongzi",    cn:"孔子",  school:"ru",  category:"people"},
      {id:"mengzi",   text:"Mengzi",    cn:"孟子",  school:"ru",  category:"people"},
      {id:"xunzi",    text:"Xunzi",     cn:"荀子",  school:"ru",  category:"people"},
      {id:"laozi",    text:"Laozi",     cn:"老子",  school:"dao", category:"people"},
      {id:"zhuangzi", text:"Zhuangzi",  cn:"庄子",  school:"dao", category:"people"},
      {id:"mozi",     text:"Mozi",      cn:"墨子",  school:"mo",  category:"people"},
      {id:"people",   text:"The People",cn:"民",    school:"mo",  category:"people"},
      {id:"shangyang",text:"Shang Yang",cn:"商鞅",  school:"fa",  category:"people"},
      {id:"hanfeizi", text:"Han Feizi", cn:"韩非子",school:"fa",  category:"people"},
    ];

    const CONCEPTS = [
      // Ru (5)
      {id:"ren",   text:"Ren",     cn:"仁",   school:"ru",  category:"concepts"},
      {id:"li",    text:"Li",      cn:"礼",   school:"ru",  category:"concepts"},
      {id:"yi",    text:"Yi",      cn:"义",   school:"ru",  category:"concepts"},
      {id:"xiao",  text:"Xiao",    cn:"孝",   school:"ru",  category:"concepts"},
      {id:"junzi", text:"Junzi",   cn:"君子", school:"ru",  category:"concepts"},
      // Dao (5)
      {id:"dao",   text:"Dao",     cn:"道",   school:"dao", category:"concepts"},
      {id:"wuwei", text:"Wu Wei",  cn:"无为", school:"dao", category:"concepts"},
      {id:"ziran", text:"Ziran",   cn:"自然", school:"dao", category:"concepts"},
      {id:"yinyang",text:"Yin-Yang",cn:"阴阳",school:"dao", category:"concepts"},
      {id:"pu",    text:"Pu",      cn:"朴",   school:"dao", category:"concepts"},
      // Mo (5)
      {id:"jianai", text:"Jian Ai", cn:"兼爱", school:"mo", category:"concepts"},
      {id:"feigong",text:"Fei Gong",cn:"非攻", school:"mo", category:"concepts"},
      {id:"shangxian",text:"Shang Xian",cn:"尚贤",school:"mo",category:"concepts"},
      {id:"jieyong",text:"Jie Yong",cn:"节用", school:"mo", category:"concepts"},
      {id:"tianzhi",text:"Tianzhi", cn:"天志", school:"mo", category:"concepts"},
      // Fa (5)
      {id:"fa",    text:"Fa",      cn:"法",   school:"fa",  category:"concepts"},
      {id:"shu",   text:"Shu",     cn:"术",   school:"fa",  category:"concepts"},
      {id:"shi",   text:"Shi",     cn:"势",   school:"fa",  category:"concepts"},
      {id:"centralization", text:"Centralization", cn:"", school:"fa", category:"concepts"},
      {id:"realism",        text:"Realism",        cn:"", school:"fa", category:"concepts"},
    ];

    const APHORISMS = [
      // Ru (3)
      {id:"ru1", text:"Do not impose on others what you yourself do not desire.", school:"ru", category:"aphorisms"},
      {id:"ru2", text:"The gentleman understands what is moral. The small man understands what is profitable.", school:"ru", category:"aphorisms"},
      {id:"ru3", text:"Learning without thought is labor lost; thought without learning is perilous.", school:"ru", category:"aphorisms"},
      // Dao (3)
      {id:"dao1", text:"The Useless Tree", school:"dao", category:"aphorisms"},
      {id:"dao2", text:"Butterfly Dream", school:"dao", category:"aphorisms"},
      {id:"dao3", text:"The greatest carver does the least cutting.", school:"dao", category:"aphorisms"},
      // Mo (3)
      {id:"mo1", text:"If everyone regarded others’ families as their own, who would create disorder?", school:"mo", category:"aphorisms"},
      {id:"mo2", text:"Elaborate funerals and music waste resources that could feed the hungry and clothe the poor.", school:"mo", category:"aphorisms"},
      {id:"mo3", text:"To kill one innocent person is murder; to kill ten is ten times the crime.", school:"mo", category:"aphorisms"},
      // Fa (3)
      {id:"fa1", text:"When the epoch changed, the ways changed; when the ways changed, the measures of government changed.", school:"fa", category:"aphorisms"},
      {id:"fa2", text:"The enlightened ruler controls his ministers through the two handles of punishment and favor.", school:"fa", category:"aphorisms"},
      {id:"fa3", text:"In the state of an enlightened ruler, law supplies the only instruction.", school:"fa", category:"aphorisms"},
    ];

    const APPLICATIONS = [
      // Ru (3)
      {id:"app1", text:"Business Ethics",        school:"ru",  category:"applications"},
      {id:"app2", text:"Education",              school:"ru",  category:"applications"},
      {id:"app3", text:"Leadership",             school:"ru",  category:"applications"},
      // Dao (3)
      {id:"app4", text:"Systems Thinking",       school:"dao", category:"applications"},
      {id:"app5", text:"Mindfulness & Flow",     school:"dao", category:"applications"},
      {id:"app6", text:"Sustainability",         school:"dao", category:"applications"},
      // Mo (3)
      {id:"app7", text:"Effective Altruism",     school:"mo",  category:"applications"},
      {id:"app8", text:"Peace Studies",          school:"mo",  category:"applications"},
      {id:"app9", text:"Meritocracy",            school:"mo",  category:"applications"},
      // Fa (3)
      {id:"app10",text:"Institutional Design",   school:"fa",  category:"applications"},
      {id:"app11",text:"Behavioral Economics",   school:"fa",  category:"applications"},
      {id:"app12",text:"Management Science",     school:"fa",  category:"applications"},
    ];

    const TOKENS = [...PEOPLE, ...CONCEPTS, ...APHORISMS, ...APPLICATIONS];
    const TOKENS_BY_ID = Object.fromEntries(TOKENS.map(t => [t.id, t]));

    // ---------- RENDERING ----------
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

    function createPill(token){
      const el = document.createElement('div');
      el.className = 'item';
      el.id = token.id;
      el.draggable = true;
      el.ondragstart = onDragStart;
      el.innerHTML = token.cn ? `${token.text} <span class="cn">${token.cn}</span>` : token.text;
      el.dataset.school = token.school;
      el.dataset.category = token.category;
      return el;
    }

    function renderBank(){
      // Clear bank grids
      ["people","concepts","aphorisms","applications"].forEach(cat=>{
        const grid = document.querySelector(`#bank-${cat} .bank-grid`);
        grid.innerHTML = "";
      });
      // Shuffle within each category and render
      shuffle([...PEOPLE]).forEach(t => document.querySelector('#bank-people .bank-grid').appendChild(createPill(t)));
      shuffle([...CONCEPTS]).forEach(t => document.querySelector('#bank-concepts .bank-grid').appendChild(createPill(t)));
      shuffle([...APHORISMS]).forEach(t => document.querySelector('#bank-aphorisms .bank-grid').appendChild(createPill(t)));
      shuffle([...APPLICATIONS]).forEach(t => document.querySelector('#bank-applications .bank-grid').appendChild(createPill(t)));
    }

    // ---------- DnD ----------
    function onDragStart(ev){ ev.dataTransfer.setData("text/plain", ev.target.id); }
    function onDragOver(ev){ ev.preventDefault(); ev.currentTarget.classList.add('highlight'); }
    function onDragLeave(ev){ ev.currentTarget.classList.remove('highlight'); }
    function onDrop(ev){
      ev.preventDefault();
      const id = ev.dataTransfer.getData("text/plain");
      const pill = document.getElementById(id);
      const zone = ev.currentTarget;
      zone.classList.remove('highlight');
      if (pill && zone.classList.contains('dropzone')) zone.appendChild(pill);
    }

    function wireDropzones(){
      document.querySelectorAll('.dropzone').forEach(z=>{
        z.addEventListener('dragover', onDragOver);
        z.addEventListener('dragleave', onDragLeave);
        z.addEventListener('drop', onDrop);
      });
    }

    // ---------- CHECK / RESET ----------
    function clearMarks(){
      document.querySelectorAll('.item').forEach(el=>{
        el.classList.remove('correct','incorrect');
      });
    }

    function checkAnswers(){
      clearMarks();
      document.querySelectorAll('.dropzone').forEach(zone=>{
        const zoneSchool = zone.dataset.school;
        const zoneCat = zone.dataset.category;
        zone.querySelectorAll('.item').forEach(item=>{
          const token = TOKENS_BY_ID[item.id];
          const ok = token && token.school === zoneSchool && token.category === zoneCat;
          item.classList.add(ok ? 'correct':'incorrect');
        });
      });
    }

    function resetBoard(){
      clearMarks();
      // Move any placed tokens back to their category bank grids
      document.querySelectorAll('.item').forEach(item=>{
        const t = TOKENS_BY_ID[item.id];
        const grid = document.querySelector(`#bank-${t.category} .bank-grid`);
        if (grid) grid.appendChild(item);
      });
      // Re-shuffle within each bank section
      renderBank();
    }

    // ---------- INIT ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      renderBank();
      wireDropzones();
    });
  </script>
</body>
</html>
