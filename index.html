<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å››å¤§å“²å­¦æµæ´¾ â€” Interactive Matrix</title>

<!-- Embedded Lishu-like font for Chinese -->
<link href="https://fonts.googleapis.com/css2?family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">

<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: Georgia, serif;
    color:#e8e8e8;
    background:
      linear-gradient(135deg, rgba(26,26,46,0.92), rgba(22,33,62,0.92)),
      url('https://upload.wikimedia.org/wikipedia/commons/8/84/Chinese_seal_script_background.png');
    background-size:cover; background-attachment:fixed; background-position:center;
    min-height:100vh; padding:24px 16px 36px;
  }

  .chinese {
    font-family: 'ZCOOL QingKe HuangYou','KaiTi','SimSun',serif;
    letter-spacing: .02em;
  }

  .container { max-width: 1600px; margin: 0 auto; }

  h1 {
    text-align:center; font-size: 2.8rem; margin-bottom:8px;
    background:linear-gradient(45deg,#d4af37,#f4e4c1);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .subtitle { text-align:center; color:#bdbdc9; margin-bottom:8px }
  .instructions { text-align:center; color:#b9b9c4; font-style:italic; margin-bottom:16px }

  /* Table */
  .table-wrapper {
    overflow-x:auto; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.1); border-radius:14px;
    padding:16px; backdrop-filter:blur(8px); margin-bottom:16px;
  }
  table { width:100%; border-collapse:separate; border-spacing:10px; font-size:1.1rem; }
  thead th {
    padding:14px 10px; text-align:center; font-weight:700;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12); border-radius:10px; position:sticky; top:0; z-index:5;
  }
  thead th:first-child { text-align:left; width:210px }
  tbody td:first-child {
    background:rgba(255,255,255,.07); font-weight:700; color:#ffd36a;
    border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:16px;
  }
  .dropzone {
    vertical-align:top; min-height:140px; padding:12px;
    border:2px dashed rgba(255,255,255,.2); border-radius:10px; transition:background .15s, outline .15s;
  }
  .dropzone.highlight { outline:2px solid rgba(255,255,255,.4); background:rgba(255,255,255,.06); }

  /* Chips */
  .chip {
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:10px 12px; margin:7px 0; border-radius:8px;
    background:rgba(0,0,0,.4); border-left:3px solid #ffd36a; font-weight:600; cursor:default;
  }
  .chip .remove { background:none; border:none; color:#ff6b6b; font-size:1rem; cursor:pointer }
  .token {  /* bank token */
    display:flex; align-items:center; gap:8px;
    padding:11px 12px; margin:8px 0; border-radius:8px; cursor:grab; user-select:none; font-weight:600;
    background:rgba(255,255,255,.12); border-left:3px solid rgba(255,255,255,.35);
    transition:background .15s ease, transform .05s ease;
  }
  .token:active { cursor:grabbing; transform:scale(.99); }
  .speaker { background:none; border:none; color:#ffd36a; font-size:1rem; cursor:pointer }

  /* Bank */
  .bank-wrapper {
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1);
    border-radius:14px; padding:16px; backdrop-filter:blur(8px);
  }
  .bank-title { text-align:center; font-weight:700; color:#f4e4c1; margin-bottom:8px }
  .bank-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:14px }
  .bank-col { background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:12px; min-height:260px }
  .bank-col h3 { text-align:center; margin-bottom:10px; color:#ffd36a; }

  /* Buttons / status */
  .btnbar { display:flex; gap:10px; justify-content:center; align-items:center; margin:14px 0 6px }
  .btn { appearance:none; border:none; border-radius:10px; padding:10px 18px; font-weight:700; cursor:pointer;
         background:#ffd36a; color:#18181b; }
  .btn.ghost { background:transparent; color:#ffd36a; outline:1px solid #ffd36a; }
  #status { text-align:center; color:#dcdce6; min-height:1.2em; margin-bottom:4px }

  @media (max-width:900px){ .bank-grid { grid-template-columns:repeat(2,1fr) } }
  @media (max-width:600px){ .bank-grid { grid-template-columns:1fr } }
</style>
</head>
<body>
<div class="container">
  <h1><span class="chinese">å››å¤§å“²å­¦æµæ´¾</span></h1>
  <div class="subtitle">The Four Great Schools of Ancient Chinese Thought</div>
  <div class="instructions">Drag tokens from the bank into any matrix cell. Bank is source-only; remove a placed token with âœ–. Click ğŸ”Š to hear the Chinese.</div>

  <!-- MATRIX -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th></th>
          <th><span class="chinese">å„’å®¶</span> Ru Jia</th>
          <th><span class="chinese">é“å®¶</span> Dao Jia</th>
          <th><span class="chinese">å¢¨å®¶</span> Mo Jia</th>
          <th><span class="chinese">æ³•å®¶</span> Fa Jia</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Key People</td>
          <td class="dropzone" data-category="Key People" data-school="å„’å®¶"></td>
          <td class="dropzone" data-category="Key People" data-school="é“å®¶"></td>
          <td class="dropzone" data-category="Key People" data-school="å¢¨å®¶"></td>
          <td class="dropzone" data-category="Key People" data-school="æ³•å®¶"></td>
        </tr>
        <tr>
          <td>Key Concepts</td>
          <td class="dropzone" data-category="Key Concepts" data-school="å„’å®¶"></td>
          <td class="dropzone" data-category="Key Concepts" data-school="é“å®¶"></td>
          <td class="dropzone" data-category="Key Concepts" data-school="å¢¨å®¶"></td>
          <td class="dropzone" data-category="Key Concepts" data-school="æ³•å®¶"></td>
        </tr>
        <tr>
          <td>Key Aphorisms / Thought Experiments</td>
          <td class="dropzone" data-category="Aphorisms" data-school="å„’å®¶"></td>
          <td class="dropzone" data-category="Aphorisms" data-school="é“å®¶"></td>
          <td class="dropzone" data-category="Aphorisms" data-school="å¢¨å®¶"></td>
          <td class="dropzone" data-category="Aphorisms" data-school="æ³•å®¶"></td>
        </tr>
        <tr>
          <td>Contemporary Applications</td>
          <td class="dropzone" data-category="Applications" data-school="å„’å®¶"></td>
          <td class="dropzone" data-category="Applications" data-school="é“å®¶"></td>
          <td class="dropzone" data-category="Applications" data-school="å¢¨å®¶"></td>
          <td class="dropzone" data-category="Applications" data-school="æ³•å®¶"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="btnbar">
    <button class="btn" onclick="checkAnswers()">Check Answers</button>
    <button class="btn ghost" onclick="clearMatrix()">Clear Matrix</button>
    <a class="btn ghost" href="admin.html">Admin</a>
  </div>
  <div id="status"></div>

  <!-- ANSWER BANK -->
  <div class="bank-wrapper">
    <div class="bank-title">Answer Bank</div>
    <div class="bank-grid">
      <div class="bank-col" id="bank-people"><h3>Key People</h3></div>
      <div class="bank-col" id="bank-concepts"><h3>Key Concepts</h3></div>
      <div class="bank-col" id="bank-aphorisms"><h3>Key Aphorisms / Thought Experiments</h3></div>
      <div class="bank-col" id="bank-apps"><h3>Contemporary Applications</h3></div>
    </div>
  </div>
</div>

<script>
/* ========= Source of Truth ========= */
const STORAGE_KEY = "wujiaTokenBankV1";

/* Default 51-token set (with ALL Chinese wrapped; Kongzi/Mengzi; The People æ°‘; no Liezi; no Shen Buhai) */
const defaultBank = {
  "Key People": [
    {id:"kongzi",       label:'Kongzi (<span class="chinese">å­”å­</span>)', pronounce:"å­”å­", correctSchool:"å„’å®¶"},
    {id:"mengzi",       label:'Mengzi (<span class="chinese">å­Ÿå­</span>)', pronounce:"å­Ÿå­", correctSchool:"å„’å®¶"},
    {id:"xunzi",        label:'Xunzi (<span class="chinese">è€å­</span>)', pronounce:"è€å­", correctSchool:"å„’å®¶"},
    {id:"laozi",        label:'Laozi (<span class="chinese">è€å­</span>)', pronounce:"è€å­", correctSchool:"é“å®¶"},
    {id:"zhuangzi",     label:'Zhuangzi (<span class="chinese">åº„å­</span>)', pronounce:"åº„å­", correctSchool:"é“å®¶"},
    {id:"mozi",         label:'Mozi (<span class="chinese">å¢¨å­</span>)', pronounce:"å¢¨å­", correctSchool:"å¢¨å®¶"},
    {id:"people",       label:'The People (<span class="chinese">æ°‘</span>)', pronounce:"æ°‘", correctSchool:"å¢¨å®¶"},
    {id:"shangyang",    label:'Shang Yang (<span class="chinese">å•†é…</span>)', pronounce:"å•†é…", correctSchool:"æ³•å®¶"},
    {id:"hanfeizi",     label:'Han Feizi (<span class="chinese">éŸ©éå­</span>)', pronounce:"éŸ©éå­", correctSchool:"æ³•å®¶"}
  ],
  "Key Concepts": [
    {id:"ren",          label:'<span class="chinese">ä»</span> Ren â€” Benevolence', pronounce:"ä»", correctSchool:"å„’å®¶"},
    {id:"li",           label:'<span class="chinese">ç¤¼</span> Li â€” Ritual propriety', pronounce:"ç¤¼", correctSchool:"å„’å®¶"},
    {id:"yi",           label:'<span class="chinese">ä¹‰</span> Yi â€” Righteousness', pronounce:"ä¹‰", correctSchool:"å„’å®¶"},
    {id:"xiao",         label:'<span class="chinese">å­</span> Xiao â€” Filial piety', pronounce:"å­", correctSchool:"å„’å®¶"},
    {id:"junzi",        label:'<span class="chinese">å›å­</span> Junzi â€” Exemplary person', pronounce:"å›å­", correctSchool:"å„’å®¶"},

    {id:"dao",          label:'<span class="chinese">é“</span> Dao â€” The Way', pronounce:"é“", correctSchool:"é“å®¶"},
    {id:"wuwei",        label:'<span class="chinese">æ— ä¸º</span> Wu wei â€” Non-action', pronounce:"æ— ä¸º", correctSchool:"é“å®¶"},
    {id:"ziran",        label:'<span class="chinese">è‡ªç„¶</span> Ziran â€” Naturalness', pronounce:"è‡ªç„¶", correctSchool:"é“å®¶"},
    {id:"yinyang",      label:'<span class="chinese">é˜´é˜³</span> Yinâ€“Yang â€” Complementary opposites', pronounce:"é˜´é˜³", correctSchool:"é“å®¶"},
    {id:"pu",           label:'<span class="chinese">æœ´</span> Pu â€” The uncarved block', pronounce:"æœ´", correctSchool:"é“å®¶"},

    {id:"jianai",       label:'<span class="chinese">å…¼çˆ±</span> Jian ai â€” Universal love', pronounce:"å…¼çˆ±", correctSchool:"å¢¨å®¶"},
    {id:"feigong",      label:'<span class="chinese">éæ”»</span> Fei gong â€” Against offensive war', pronounce:"éæ”»", correctSchool:"å¢¨å®¶"},
    {id:"shangxian",    label:'<span class="chinese">å°šè´¤</span> Shang xian â€” Elevate the worthy', pronounce:"å°šè´¤", correctSchool:"å¢¨å®¶"},
    {id:"jieyong",      label:'<span class="chinese">èŠ‚ç”¨</span> Jie yong â€” Frugality', pronounce:"èŠ‚ç”¨", correctSchool:"å¢¨å®¶"},
    {id:"tianzhi",      label:'<span class="chinese">å¤©å¿—</span> Tianzhi â€” Will of Heaven', pronounce:"å¤©å¿—", correctSchool:"å¢¨å®¶"},

    {id:"fa",           label:'<span class="chinese">æ³•</span> Fa â€” Law', pronounce:"æ³•", correctSchool:"æ³•å®¶"},
    {id:"shu",          label:'<span class="chinese">æœ¯</span> Shu â€” Administrative technique', pronounce:"æœ¯", correctSchool:"æ³•å®¶"},
    {id:"shi",          label:'<span class="chinese">åŠ¿</span> Shi â€” Positional power', pronounce:"åŠ¿", correctSchool:"æ³•å®¶"}
  ],
  "Aphorisms": [
    {id:"ru1", label:'<span class="chinese">å·±æ‰€ä¸æ¬²ï¼Œå‹¿æ–½äºäºº</span> â€” Do not impose on others what you do not desire.', pronounce:"å·±æ‰€ä¸æ¬² å‹¿æ–½äºäºº", correctSchool:"å„’å®¶"},
    {id:"ru2", label:'<span class="chinese">å›å­å–»äºä¹‰ï¼Œå°äººå–»äºåˆ©</span> â€” The gentleman understands what is moral; the small man what is profitable.', pronounce:"å›å­å–»äºä¹‰ å°äººå–»äºåˆ©", correctSchool:"å„’å®¶"},
    {id:"ru3", label:'<span class="chinese">å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†</span> â€” Learning without thought is lost; thought without learning is perilous.', pronounce:"å­¦è€Œä¸æ€åˆ™ç½” æ€è€Œä¸å­¦åˆ™æ®†", correctSchool:"å„’å®¶"},

    {id:"dao1", label:'<span class="chinese">æ— ç”¨ä¹‹æœ¨</span> â€” The Useless Tree (it survives because it has no use).', pronounce:"æ— ç”¨ä¹‹æœ¨", correctSchool:"é“å®¶"},
    {id:"dao2", label:'<span class="chinese">åº„å‘¨æ¢¦è¶</span> â€” Butterfly Dream (who dreams whom?).', pronounce:"åº„å‘¨æ¢¦è¶", correctSchool:"é“å®¶"},
    {id:"dao3", label:'<span class="chinese">å¤§åŒ ä¸å‰²</span> â€” The greatest carver does the least cutting.', pronounce:"å¤§åŒ ä¸å‰²", correctSchool:"é“å®¶"},

    {id:"mo1", label:'If everyone regarded othersâ€™ families as their own, disorder would cease.', pronounce:"è§†äººä¹‹å›½è‹¥å…¶å›½ è§†äººä¹‹å®¶è‹¥å…¶å®¶", correctSchool:"å¢¨å®¶"},
    {id:"mo2", label:'<span class="chinese">åšè‘¬ä¹…ä¸§</span>ä¸ä¹éä¹‰ â€” Elaborate funerals/music waste resources that could aid the poor.', pronounce:"åšè‘¬ä¹…ä¸§ ä¸ ä¹éä¹‰", correctSchool:"å¢¨å®¶"},
    {id:"mo3", label:'<span class="chinese">æ€ä¸€ä¸ä¹‰è€…ç½ªä¸€ï¼Œæ€åç½ªå</span> â€” Killing ten is ten times the crime.', pronounce:"æ€ä¸€ä¸ä¹‰è€…ç½ªä¸€ æ€åç½ªå", correctSchool:"å¢¨å®¶"},

    {id:"fa1", label:'When times change, measures of government must change.', pronounce:"ä¸–å¼‚åˆ™äº‹å¼‚ äº‹å¼‚åˆ™æ³•å¼‚", correctSchool:"æ³•å®¶"},
    {id:"fa2", label:'The ruler governs by the two handles of punishment and favor.', pronounce:"ä»¥åˆ‘å¾·äºŒæŸ„å¾¡è‡£", correctSchool:"æ³•å®¶"},
    {id:"fa3", label:'In an enlightened state, law supplies the only instruction.', pronounce:"æ˜ä¸»ä¹‹å›½ æ— ä¹¦è€Œæ³•ä¸ºæ•™", correctSchool:"æ³•å®¶"}
  ],
  "Applications": [
    {id:"ru-app1", label:'Business Ethics â€” CSR, stakeholders, long-term relations', pronounce:"", correctSchool:"å„’å®¶"},
    {id:"ru-app2", label:'Education â€” character & mentorship', pronounce:"", correctSchool:"å„’å®¶"},
    {id:"ru-app3", label:'Leadership â€” moral example & ritual culture', pronounce:"", correctSchool:"å„’å®¶"},

    {id:"dao-app1", label:'Systems Thinking â€” minimal intervention', pronounce:"", correctSchool:"é“å®¶"},
    {id:"dao-app2", label:'Mindfulness & Flow â€” acceptance, balance', pronounce:"", correctSchool:"é“å®¶"},
    {id:"dao-app3", label:'Sustainability â€” biomimicry, circularity', pronounce:"", correctSchool:"é“å®¶"},

    {id:"mo-app1", label:'Effective Altruism â€” evidence-based charity', pronounce:"", correctSchool:"å¢¨å®¶"},
    {id:"mo-app2", label:'Peace Studies â€” rational conflict resolution', pronounce:"", correctSchool:"å¢¨å®¶"},
    {id:"mo-app3", label:'Meritocracy â€” skills-based hiring', pronounce:"", correctSchool:"å¢¨å®¶"},

    {id:"fa-app1", label:'Institutional Design â€” clear public rules', pronounce:"", correctSchool:"æ³•å®¶"},
    {id:"fa-app2", label:'Behavioral Economics â€” incentive structures', pronounce:"", correctSchool:"æ³•å®¶"},
    {id:"fa-app3", label:'Management Science â€” KPIs & accountability', pronounce:"", correctSchool:"æ³•å®¶"}
  ]
};

/* Storage helpers */
function loadBank() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return null;
  try { return JSON.parse(raw); } catch { return null; }
}
function saveBank(bank) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(bank));
}

/* Seed localStorage on first run */
function ensureBank() {
  let bank = loadBank();
  if (!bank) {
    bank = defaultBank;
    saveBank(bank);
  }
  return bank;
}

/* Render bank columns (read-only, draggable source) */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

function makeTokenEl(item){
  const el = document.createElement('div');
  el.className = 'token';
  el.dataset.id = item.id;
  el.dataset.category = findCategory(item.id);
  el.innerHTML = `
    <span>${item.label}</span>
    ${item.pronounce ? `<button class="speaker" data-pronounce="${item.pronounce}" title="Pronounce">ğŸ”Š</button>` : ``}
  `;
  el.draggable = true;
  el.addEventListener('dragstart', (e)=>{
    e.dataTransfer.setData('text/plain', item.id);
  });
  return el;
}

function findCategory(id){
  for(const cat of Object.keys(currentBank)){
    if(currentBank[cat].some(x=>x.id===id)) return cat;
  }
  return "";
}

function renderBank(){
  const cols = {
    "Key People": document.getElementById('bank-people'),
    "Key Concepts": document.getElementById('bank-concepts'),
    "Aphorisms": document.getElementById('bank-aphorisms'),
    "Applications": document.getElementById('bank-apps')
  };
  // Clear while keeping headers
  Object.values(cols).forEach(col=>{
    [...col.children].forEach((child, idx)=>{ if(idx>0) col.removeChild(child); });
  });

  for(const [cat, arr] of Object.entries(currentBank)){
    const col = cols[cat];
    shuffle([...arr]).forEach(item => col.appendChild(makeTokenEl(item)));
  }
}

/* Matrix drop handling: only table cells accept drops. Adds a copy (chip) with remove button. */
function wireDropzones(){
  document.querySelectorAll('.dropzone').forEach(zone=>{
    zone.addEventListener('dragover', e=>{ e.preventDefault(); zone.classList.add('highlight'); });
    zone.addEventListener('dragleave', ()=> zone.classList.remove('highlight'));
    zone.addEventListener('drop', e=>{
      e.preventDefault(); zone.classList.remove('highlight');
      const id = e.dataTransfer.getData('text/plain');
      if(!id) return;
      const item = getItemById(id);
      if(!item) return;
      // create a placed chip (copy; bank remains full)
      const chip = document.createElement('div');
      chip.className = 'chip';
      chip.dataset.id = item.id;
      chip.innerHTML = `
        <span>${item.label}</span>
        <div>
          ${item.pronounce ? `<button class="speaker" data-pronounce="${item.pronounce}" title="Pronounce">ğŸ”Š</button>` : ``}
          <button class="remove" title="Remove">âœ–</button>
        </div>
      `;
      chip.querySelector('.remove').onclick = ()=> chip.remove();
      zone.appendChild(chip);
    });
  });
}

/* Audio */
document.body.addEventListener('click', e=>{
  if(e.target.classList.contains('speaker')){
    const phrase = e.target.dataset.pronounce;
    if('speechSynthesis' in window && phrase){
      const u = new SpeechSynthesisUtterance(phrase);
      u.lang = 'zh-CN'; u.rate = 0.9;
      speechSynthesis.speak(u);
    }
  }
});

/* Helpers */
function getItemById(id){
  for(const cat of Object.keys(currentBank)){
    const it = currentBank[cat].find(x=>x.id===id);
    if(it) return it;
  }
  return null;
}

/* Check answers: compare placed chip ids vs expected school for that cell */
function checkAnswers(){
  const key = buildAnswerKeyFromBank(currentBank);
  let correct = 0, total = 0;

  document.querySelectorAll('.dropzone').forEach(cell=>{
    const cat = cell.dataset.category;
    const school = cell.dataset.school; // å„’å®¶/é“å®¶/å¢¨å®¶/æ³•å®¶
    const expected = (key[cat] && key[cat][school]) ? new Set(key[cat][school]) : new Set();
    const chips = [...cell.querySelectorAll('.chip')];
    chips.forEach(ch => {
      total++;
      const ok = expected.has(ch.dataset.id);
      ch.style.borderColor = ok ? '#2ecc71' : '#e74c3c';
      if(ok) correct++;
    });
  });

  document.getElementById('status').textContent = `Score: ${correct} / ${total}`;
}

function buildAnswerKeyFromBank(bank){
  const out = {
    "Key People": { "å„’å®¶":[], "é“å®¶":[], "å¢¨å®¶":[], "æ³•å®¶":[] },
    "Key Concepts": { "å„’å®¶":[], "é“å®¶":[], "å¢¨å®¶":[], "æ³•å®¶":[] },
    "Aphorisms": { "å„’å®¶":[], "é“å®¶":[], "å¢¨å®¶":[], "æ³•å®¶":[] },
    "Applications": { "å„’å®¶":[], "é“å®¶":[], "å¢¨å®¶":[], "æ³•å®¶":[] }
  };
  for(const [cat, arr] of Object.entries(bank)){
    arr.forEach(item=>{
      const sch = item.correctSchool || "";
      if(out[cat] && out[cat][sch]) out[cat][sch].push(item.id);
    });
  }
  return out;
}

function clearMatrix(){
  document.querySelectorAll('.dropzone .chip').forEach(ch => ch.remove());
  document.getElementById('status').textContent = '';
}

/* Init */
let currentBank = ensureBank();

document.addEventListener('DOMContentLoaded', ()=>{
  renderBank();
  wireDropzones();
});
</script>
</body>
</html>
